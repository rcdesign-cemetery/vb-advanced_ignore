<?xml version="1.0" encoding="ISO-8859-1"?>

<product productid="rcd_advanced_ignore" active="1">
	<title>Advanced Ignore</title>
	<description>Provides ignore rendering customizations.</description>
	<version>0.1</version>
	<url><![CDATA[http://www.vbulletin.org/forum/misc.php?do=producthelp&pid=rcd_advanced_ignore]]></url>
	<versioncheckurl><![CDATA[http://www.vbulletin.org/forum/misc.php?do=productcheck&pid=rcd_advanced_ignore]]></versioncheckurl>
	<apm_releasedate>0</apm_releasedate>
	<apm_author />
	<apm_relatedurl />
	<apm_extrainfo />
	<apm_extraedit />
	<dependencies>
	</dependencies>
	<codes>
	</codes>
	<templates>
		<template name="advanced_ignore_notice" templatetype="template" date="1284663277" username="Vitaly" version="0.1"><![CDATA[<h2 class="title" style="text-align:center">{vb:rawphrase rcd_ai_is_ignored}</h2>]]></template>
		<template name="advanced_ignore_post" templatetype="template" date="1285083275" username="ruseinov" version="0.1"><![CDATA[<li class="postbitignored postbitim" id="post_{vb:raw post.postid}" style="display:none">
    
</li>]]></template>
	</templates>
	<stylevardfns>
	</stylevardfns>
	<stylevars>
	</stylevars>
	<plugins>
		<plugin active="1" executionorder="5">
			<title>Cache templates</title>
			<hookname>cache_templates</hookname>
			<phpcode><![CDATA[if (THIS_SCRIPT == 'showthread')
{
    $cache[] = 'advanced_ignore_notice';
    $cache[] = 'advanced_ignore_post';
}]]></phpcode>
		</plugin>
		<plugin active="1" executionorder="10">
			<title><![CDATA[Init permissions & template]]></title>
			<hookname>parse_templates</hookname>
			<phpcode><![CDATA[if (THIS_SCRIPT == 'forumdisplay')
{
    global $rcd_ai_show_ignored, $rcd_ai_thrdbit_tpl, $rcd_ai_thrdbit_deletd_tpl;

    $rcd_ai_thrdbit_tpl = $vbulletin->templatecache['threadbit'];
    $rcd_ai_thrdbit_deletd_tpl = $vbulletin->templatecachep['threadbit_deleted'];
    
    if (can_moderate())
    {
        $rcd_ai_show_ignored = true; 
    }
}]]></phpcode>
		</plugin>
		<plugin active="1" executionorder="5">
			<title>Postbit Ignore End</title>
			<hookname>postbit_display_complete</hookname>
			<phpcode><![CDATA[if($post['rcd_ai_template'])
{
    global $rcd_ai_template;
    $template_hook["postbit_messagearea_start"] .= $rcd_ai_template;
}]]></phpcode>
		</plugin>
		<plugin active="1" executionorder="5">
			<title>Postbit Ignore Start</title>
			<hookname>showthread_postbit_create</hookname>
			<phpcode><![CDATA[global $rcd_ai_show_ignored;
$post['rcd_ai_template'] = false;
if($ignore[$post['userid']])
{    
    if($rcd_ai_show_ignored)
    {      
       $post['rcd_ai_template'] = true;
       $fetchtype = 'post';
    }
}]]></phpcode>
		</plugin>
		<plugin active="1" executionorder="5">
			<title><![CDATA[Init template & permissions]]></title>
			<hookname>showthread_post_start</hookname>
			<phpcode><![CDATA[// Change template
$vbulletin->templatecache['postbit_ignore'] = $vbulletin->templatecache['advanced_ignore_post'];
global $rcd_ai_template, $rcd_ai_show_ignored;
if (can_moderate())
{
    $rcd_ai_show_ignored = true;
    $rcd_ai_template = vB_Template::create('advanced_ignore_notice');
    $rcd_ai_template = $rcd_ai_template->render();
}]]></phpcode>
		</plugin>
		<plugin active="1" executionorder="5">
			<title>Hide threads of ignored users.</title>
			<hookname>threadbit_display</hookname>
			<phpcode><![CDATA[global $rcd_ai_show_ignored, $rcd_ai_thrdbit_tpl, $rcd_ai_thrdbit_deletd_tpl;

if ($ignore[$thread['postuserid']] && !$rcd_ai_show_ignored)
{  
    $vbulletin->templatecache['threadbit'] = '$final_rendered = \'\';';
    $vbulletin->templatecache['threadbit_deleted'] = '$final_rendered = \'\';';     
}
else
{
    $vbulletin->templatecache['threadbit'] =  $rcd_ai_thrdbit_tpl;
    $vbulletin->templatecache['threadbit_deleted'] =  $rcd_ai_thrdbit_deletd_tpl;   
}]]></phpcode>
		</plugin>
	</plugins>
	<phrases>
		<phrasetype name="GLOBAL" fieldname="global">
			<phrase name="rcd_ai_is_ignored" date="1284658370" username="ruseinov" version=""><![CDATA[Ignored...]]></phrase>
		</phrasetype>
	</phrases>
	<options>
	</options>
	<helptopics>
	</helptopics>
	<cronentries>
	</cronentries>
	<faqentries>
	</faqentries>
	<templateedits>
	</templateedits>
</product>
